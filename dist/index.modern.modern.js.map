{"version":3,"file":"index.modern.modern.js","sources":["../src/exception.js","../src/constants.js","../src/index.js","../src/validator.js","../src/factory.js"],"sourcesContent":["export default class ValidationError extends Error {}\n","export default Object.freeze({\n  JOI: 'joi',\n  AJV: 'ajv',\n  SUPERSTRUCT: 'superstruct',\n});\n","import validator from './validator';\nimport Constants from './constants';\n\nexport default class VuexStoreValidator {\n  constructor({ engine = Constants.JOI, strict = false, extend = {} } = {}) {\n    Object.assign(this, { engine, strict, extend });\n\n    return this.handle.bind(this);\n  }\n\n  handle(store) {\n    store.subscribe(async ({ type, payload }) => {\n      await validator(store, this).validate({ type, payload });\n    });\n  }\n}\n\n/* istanbul ignore next */\nif (window.Vue) {\n  window.VuexStoreValidator = VuexStoreValidator;\n}\n\nexport const ENGINE = Constants;\n","import factory from './factory';\nimport ValidationError from './exception';\n\nconst validator = (store, params) => {\n  const { extend, strict, engine } = params;\n  const { _modules: modules, _modulesNamespaceMap: modulesNamespaceMap } = store;\n\n  const getModuleByNamespace = (namespace) => {\n    let name = namespace;\n    if (name && namespace.charAt(namespace.length - 1) !== '/') {\n      name += '/';\n    }\n\n    return modulesNamespaceMap[name] || modules.root;\n  };\n\n  const getRulesByType = (type) => {\n    const pathSplit = type.split('/');\n    const mutation = pathSplit.pop();\n    const { _rawModule: rawModule } = getModuleByNamespace(pathSplit.join('/'));\n    const schema = (rawModule.rules || {})[mutation];\n\n    if (strict && !schema) {\n      throw new ValidationError(`[Strict Mode] Rules are not defined for: ${type}`);\n    }\n\n    return (typeof schema === 'function') ? schema : () => schema;\n  };\n\n  const Worker = {\n    execute: async ({ type, payload }) => {\n      const schema = await getRulesByType(type, payload)(store, payload);\n      const handler = await factory(engine, extend);\n      const error = await handler(schema, payload);\n\n      if (error) {\n        throw new Error(error);\n      }\n    },\n    validate: async ({ type, payload }) => {\n      try {\n        await Worker.execute({ type, payload });\n      } catch ({ message }) {\n        throw new ValidationError(`${message} for mutation: ${type}`);\n      }\n    },\n  };\n\n  return Worker;\n};\n\nexport default validator;\n","const factory = async (key, extend) => {\n  /* istanbul ignore next */\n  const resolve = (module) => module.default || module;\n  const supported = {\n    ajv: () => import('./engines/ajv').then(resolve),\n    joi: () => import('./engines/joi').then(resolve),\n    superstruct: () => import('./engines/superstruct').then(resolve),\n  };\n\n  if (Object.keys(supported).includes(key)) {\n    const module = await supported[key]();\n\n    return module;\n  }\n\n  if (extend && Object.keys(extend).includes(key)) {\n    return extend[key];\n  }\n\n  throw new Error(`Validation Engine for \"${key}\" not found.`);\n};\n\nexport default factory;\n"],"names":["ValidationError","Error","Object","freeze","JOI","AJV","SUPERSTRUCT","VuexStoreValidator","constructor","engine","Constants","strict","extend","assign","this","handle","bind","store","subscribe","async","type","payload","params","_modules","modules","_modulesNamespaceMap","modulesNamespaceMap","Worker","execute","schema","pathSplit","split","mutation","pop","_rawModule","rawModule","namespace","name","charAt","length","root","getModuleByNamespace","join","rules","getRulesByType","handler","key","resolve","module","default","supported","ajv","import","then","joi","superstruct","keys","includes","factory","error","validate","message","validator","_this","window","Vue","ENGINE"],"mappings":"MAAqBA,UAAwBC,OCA7C,MAAeC,OAAOC,OAAO,CAC3BC,IAAK,MACLC,IAAK,MACLC,YAAa,sBCAMC,EACnBC,aAAYC,OAAEA,EAASC,EAAUN,IAArBO,OAA0BA,GAAS,EAAnCC,OAA0CA,EAAS,IAAO,IAGpE,OAFAV,OAAOW,OAAOC,KAAM,CAAEL,OAAAA,EAAQE,OAAAA,EAAQC,OAAAA,SAE1BG,OAAOC,KAAKF,MAG1BC,OAAOE,cACLA,EAAMC,UAAUC,gBAAOC,KAAEA,EAAFC,QAAQA,SCRjB,EAACJ,EAAOK,KACxB,MAAMV,OAAEA,EAAFD,OAAUA,EAAVF,OAAkBA,GAAWa,GAC3BC,SAAUC,EAASC,qBAAsBC,GAAwBT,EAwBnEU,EAAS,CACbC,QAAST,OAASC,KAAAA,EAAMC,QAAAA,MACtB,MAAMQ,OAfcT,CAAAA,IACtB,MAAMU,EAAYV,EAAKW,MAAM,KACvBC,EAAWF,EAAUG,OACnBC,WAAYC,GAZQC,CAAAA,IAC5B,IAAIC,EAAOD,EAKX,OAJIC,GAAmD,MAA3CD,EAAUE,OAAOF,EAAUG,OAAS,KAC9CF,GAAQ,KAGHX,EAAoBW,IAASb,EAAQgB,MAMVC,CAAqBX,EAAUY,KAAK,MAChEb,GAAUM,EAAUQ,OAAS,IAAIX,GAEvC,GAAIrB,IAAWkB,EACb,UAAU7B,EAAiB,4CAA2CoB,GAGxE,MAA0B,mBAAXS,EAAyBA,EAAS,IAAMA,GAKhCe,CAAexB,EAAfwB,CAA8B3B,EAAOI,GACpDwB,OChCI1B,OAAO2B,EAAKlC,KAE1B,MAAMmC,EAAWC,GAAWA,EAAOC,SAAWD,EACxCE,EAAY,CAChBC,IAAK,IAAMC,OAAO,qBAAiBC,KAAKN,GACxCO,IAAK,IAAMF,OAAO,qBAAiBC,KAAKN,GACxCQ,YAAa,IAAMH,OAAO,6BAAyBC,KAAKN,IAG1D,GAAI7C,OAAOsD,KAAKN,GAAWO,SAASX,GAGlC,aAFqBI,EAAUJ,KAKjC,GAAIlC,GAAUV,OAAOsD,KAAK5C,GAAQ6C,SAASX,GACzC,OAAOlC,EAAOkC,GAGhB,UAAU7C,MAAO,0BAAyB6C,kBDahBY,CAAQjD,EAAQG,GAChC+C,QAAcd,EAAQhB,EAAQR,GAEpC,GAAIsC,EACF,UAAU1D,MAAM0D,IAGpBC,SAAUzC,OAASC,KAAAA,EAAMC,QAAAA,MACvB,UACQM,EAAOC,QAAQ,CAAER,KAAAA,EAAMC,QAAAA,IAC7B,OAAOwC,QAAEA,IACT,UAAU7D,EAAiB,GAAE6D,mBAAyBzC,QAK5D,OAAOO,GDpCGmC,CAAU7C,EAAO8C,GAAMH,SAAS,CAAExC,KAAAA,EAAMC,QAAAA,OAMhD2C,OAAOC,MACTD,OAAOzD,mBAAqBA,GAG9B,MAAa2D,EAASxD"}