{"version":3,"file":"index.js","sources":["../src/engines/ajv.js","../src/engines/joi.js","../src/exception.js","../src/constants.js","../src/index.js","../src/validator.js","../src/factory.js"],"sourcesContent":["import Ajv from 'ajv';\n\nconst getErrorMessages = (errors) => errors.map((item) => item.message).join(', ');\n\nexport default (schema, data) => {\n  const ajv = new Ajv({ jsonPointers: true, $data: true });\n  const validate = ajv.compile(schema);\n  validate(data);\n\n  const { errors } = validate;\n\n  return errors && getErrorMessages(errors);\n};\n","export default (schema, data) => {\n  const format = schema || { validate: () => ({}) };\n  const { error } = format.validate(data);\n\n  return error && error.message;\n};\n","export default class ValidationError extends Error {}\n","export default Object.freeze({\n  JOI: 'joi',\n  AJV: 'ajv',\n});\n","import validator from './validator';\nimport Constants from './constants';\n\nexport default class VuexStoreValidator {\n  constructor({ engine = Constants.JOI, strict = false, extend = {} } = {}) {\n    Object.assign(this, { engine, strict, extend });\n\n    return validator(this);\n  }\n}\n\n/* istanbul ignore next */\nif (window.Vue) {\n  window.VuexStoreValidator = VuexStoreValidator;\n}\n\nexport const ENGINE = Constants;\n","import factory from './factory';\nimport ValidationError from './exception';\n\nconst validator = ({ extend, strict, engine }) => (store) => {\n  const { _modules: modules, _modulesNamespaceMap: modulesNamespaceMap } = store;\n\n  const getModuleByNamespace = (namespace) => {\n    let name = namespace;\n    if (name && namespace.charAt(namespace.length - 1) !== '/') {\n      name += '/';\n    }\n\n    const module = modulesNamespaceMap[name];\n\n    return module;\n  };\n\n  const getRulesByType = (type, payload) => {\n    const target = '_rawModule';\n    const pathArray = type.split('/');\n    const fn = pathArray.pop();\n    const module = getModuleByNamespace(pathArray.join('/'));\n    const { rules = {} } = (module || modules.root)[target];\n    const schema = rules[fn];\n\n    if (strict && !schema) {\n      throw new ValidationError(`[Strict Mode] Rules are not defined for: ${type}`);\n    }\n\n    return (typeof schema === 'function') ? schema(store, payload) : schema;\n  };\n\n  store.subscribe(({ type, payload }) => {\n    const execute = factory(engine, extend);\n    const schema = getRulesByType(type, payload);\n    const error = execute(schema, payload);\n\n    if (error) {\n      throw new ValidationError(`${error} for mutation: ${type}`);\n    }\n  });\n};\n\nexport default validator;\n","import ajv from './engines/ajv';\nimport joi from './engines/joi';\n\nconst factory = (key, extend) => {\n  const available = { ajv, joi, ...extend };\n\n  if (Object.keys(available).includes(key)) {\n    return available[key];\n  }\n\n  throw new Error(`Validation Engine for \"${key}\" not found.`);\n};\n\nexport default factory;\n"],"names":["schema","data","validate","Ajv","jsonPointers","$data","compile","errors","map","item","message","join","getErrorMessages","format","error","ValidationError","Error","Object","freeze","JOI","AJV","VuexStoreValidator","constructor","engine","Constants","strict","extend","assign","this","store","_modules","modules","_modulesNamespaceMap","modulesNamespaceMap","subscribe","type","payload","key","available","ajv","joi","keys","includes","factory","execute","pathArray","split","fn","pop","module","namespace","name","charAt","length","getModuleByNamespace","rules","root","getRulesByType","validator","window","Vue"],"mappings":"6EAIgBA,EAAQC,KACtB,MACMC,EADM,IAAIC,EAAI,CAAEC,cAAc,EAAMC,OAAO,IAC5BC,QAAQN,GAC7BE,EAASD,GAET,MAAMM,OAAEA,GAAWL,EAEnB,OAAOK,GATiBA,CAAAA,GAAWA,EAAOC,IAAKC,GAASA,EAAKC,SAASC,KAAK,MAS1DC,CAAiBL,OCXpBP,EAAQC,KACtB,MAAMY,EAASb,GAAU,CAAEE,SAAU,WAC/BY,MAAEA,GAAUD,EAAOX,SAASD,GAElC,OAAOa,GAASA,EAAMJ,eCJHK,UAAwBC,OCA7C,MAAeC,OAAOC,OAAO,CAC3BC,IAAK,MACLC,IAAK,cCCcC,EACnBC,aAAYC,OAAEA,EAASC,EAAUL,IAArBM,OAA0BA,GAAS,EAAnCC,OAA0CA,EAAS,IAAO,IAGpE,OAFAT,OAAOU,OAAOC,KAAM,CAAEL,OAAAA,EAAQE,OAAAA,EAAQC,OAAAA,ICFxB,GAAGA,OAAAA,EAAQD,OAAAA,EAAQF,OAAAA,KAAcM,IACjD,MAAQC,SAAUC,EAASC,qBAAsBC,GAAwBJ,EA4BzEA,EAAMK,UAAU,EAAGC,KAAAA,EAAMC,QAAAA,MACvB,MAEMtB,EChCM,EAACuB,EAAKX,KACpB,MAAMY,EAAY,CAAEC,IAAAA,EAAKC,IAAAA,KAAQd,GAEjC,GAAIT,OAAOwB,KAAKH,GAAWI,SAASL,GAClC,OAAOC,EAAUD,GAGnB,UAAUrB,MAAO,0BAAyBqB,kBDuBxBM,CAAQpB,EAAQG,EAElBkB,CAlBO,EAACT,EAAMC,KAC5B,MACMS,EAAYV,EAAKW,MAAM,KACvBC,EAAKF,EAAUG,MACfC,EAfsBC,CAAAA,IAC5B,IAAIC,EAAOD,EAOX,OANIC,GAAmD,MAA3CD,EAAUE,OAAOF,EAAUG,OAAS,KAC9CF,GAAQ,KAGKlB,EAAoBkB,IASpBG,CAAqBT,EAAUlC,KAAK,OAC7C4C,MAAEA,EAAQ,KAAQN,GAAUlB,EAAQyB,MAAnB,WACjBxD,EAASuD,EAAMR,GAErB,GAAItB,IAAWzB,EACb,UAAUe,EAAiB,4CAA2CoB,GAGxE,MAA0B,mBAAXnC,EAAyBA,EAAO6B,EAAOO,GAAWpC,GAKlDyD,CAAetB,EAAMC,GACNA,GAE9B,GAAItB,EACF,UAAUC,EAAiB,GAAED,mBAAuBqB,QD/B/CuB,CAAU9B,OAKjB+B,OAAOC,MACTD,OAAOtC,mBAAqBA,kBAGRG"}